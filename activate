PACKAGE_NAME=skeleton  # __NAME__

development () {
    SETUP_MODE=development compose \
        -f docker-compose.yml \
        -f docker-compose.override.yml \
        "$@"
}

release () {
    SETUP_MODE=release compose \
        -f docker-compose.yml \
        -f docker-compose.override.yml \
        -f docker-compose.production.yml \
        "$@"
}

production () {
    compose \
        -f docker-compose.yml \
        -f docker-compose.production.yml \
        "$@"
}

manage () {
    development run --rm -e SQLALCHEMY_ECHO=false app \
        /venv/bin/python -m $PACKAGE_NAME "$@"
}

compose () {
    VERSION=$(cat VERSION) docker-compose "$@"
}

deactivate () {
    unset -f development
    unset -f release
    unset -f production
    unset -f manage
    unset -f compose
    unset -f deactivate
    PS1="$_OLD_PS1"
    export PS1
    unset _OLD_PS1
}

_OLD_PS1="$PS1"
PS1="($PACKAGE_NAME)$PS1"
export PS1
